import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from scipy import stats

# dataframe imported
df = pd.read_csv("athlete_events.csv")

# relevant columns filtered
numerics = ["Age", "Height", "Weight"]
df_num = df[numerics].dropna()

# statistics
statistics = df_num.describe().T    # med, sdt, min, max, quartis
statistics["var"] = df_num.var()
statistics["median"] = df_num.median()
statistics["mode"] = df_num.mode().iloc[0]
statistics["skew"] = df_num.skew()
statistics["kurtosis"] = df_num.kurtosis()

cov = df_num.cov()
corr = df_num.corr()

# Excel export
with pd.ExcelWriter("results.xlsx", engine="openpyxl") as writer:
    statistics.to_excel(writer, sheet_name="Statistics")
    cov.to_excel(writer, sheet_name="Covariance")
    corr.to_excel(writer, sheet_name="Correlation")

print("✅ Resultados exportados para results.xlsx")

# Graphs

# Histogram
df_num.hist(bins=20, figsize=(10, 6))
plt.suptitle("Histograms")
plt.savefig("histograms.png")
plt.close()

# Boxplot | 'Medidas de dispersão'
plt.figure(figsize=(8, 5))
sns.boxplot(data=df_num)
plt.title("Boxplot")
plt.savefig("boxplot.png")
plt.close()

# Dispersal between heigh & weight
plt.figure(figsize=(6, 4))
sns.scatterplot(x="Height", y="Weight", data=df_num)
plt.title("Dispersal | Height x Weight")
plt.savefig("dispersal.png")
plt.close()

# Density (KDE) with percentiles
plt.figure(figsize=(6, 4))
sns.kdeplot(df_num["Age"], fill=True)
for p in [25, 50, 75]:
    plt.axvline(np.percentile(df_num["Age"], p))
plt.legend()
plt.title("Age distribution with percentiles")
plt.savefig("age_percentiles.png")
plt.close()

print("✅ Gráficos salvos (histograms.png, boxplot.png, dispersal.png, age_percentiles.png)")

